<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>오류고등학교 1학년 수강신청 시뮬레이터</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f7f9fb;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
  }
  .semester-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .semester {
    width: 400px;
    border: 2px solid #ccc;
    border-radius: 10px;
    background: #fff;
    padding: 15px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }
  .semester h2 {
    text-align: center;
    font-size: 18px;
    margin-bottom: 10px;
  }
  .course-area {
    margin-bottom: 12px;
  }
  .area-title {
    font-weight: bold;
    margin: 10px 0 6px;
  }
  .course-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .course-item {
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    background-color: #eee;
    font-size: 13px;
  }
  .course-item.fixed {
    cursor: not-allowed;
  }
  .basket {
    border: 2px dashed #aaa;
    border-radius: 8px;
    padding: 10px;
    min-height: 60px;
    margin-top: 10px;
  }
  .basket-title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 5px;
  }
  .highlight-valid {
  animation: blinkGreenEnhanced 0.7s infinite alternate;
  border-width: 3px;
  box-shadow: 0 0 10px rgba(76, 175, 80, 0.6); /* 연두색 그림자 */
}

@keyframes blinkGreenEnhanced {
  0% {
    border-color: #4CAF50;
    background-color: #e8f5e9; /* 연두 배경 */
  }
  100% {
    border-color: #81C784;
    background-color: #f1f8e9; /* 더 옅은 연두 */
  }
}

  .course-korean { background-color: #fff9c4; }
  .course-math { background-color: #bbdefb; }
  .course-english { background-color: #ffcdd2; }
  .course-science { background-color: #c8e6c9; }
  .course-society { background-color: #ffe0b2; }
  .course-physical { background-color: #CCD5FF; }
  .course-language { background-color: #e1bee7; }
  .course-art { background-color: #f8bbd0; }
  .course-info { background-color: #b2dfdb; }
  .course-liberal { background-color: #e4dcd9; }
  .message {
    color: red;
    font-size: 14px;
    margin-top: 10px;
  }
.legend {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
}

.legend-item {
  font-size: 13px;
  padding: 4px 10px;
  border-radius: 8px;
  background-color: #eee;
  color: #333;
  white-space: nowrap;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
#studentInfo {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
  }
 .footer {
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-size: 20px;
    color: #888;
  }
.notice-box {
  max-width: 860px;
  margin: 0 auto 20px;
  background-color: #fffde7;
  border: 2px solid #fbc02d;
  border-radius: 10px;
  padding: 15px 20px;
  font-size: 14px;
  color: #444;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}
.notice-box h3 {
  margin: 0 0 8px;
  font-size: 16px;
  color: #e65100;
}
.notice-box ul {
  padding-left: 20px;
  margin: 0;
}
.notice-box li {
  margin-bottom: 6px;
  line-height: 1.5;
}
.total-summary-box {
  max-width: 800px;
  margin: 40px auto 0;
  background-color: #e8f5e9;
  border: 2px solid #4CAF50;
  border-radius: 10px;
  padding: 16px 20px;
  font-size: 15px;
  color: #2e7d32;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}
.total-summary-box h3 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 16px;
  color: #1b5e20;
}
.total-summary-box p {
  margin: 4px 0;
  font-weight: bold;
}
.red-outline {
  outline: 2px solid red !important;
  outline-offset: -2px;
}
</style>

</head>

<body>
  <h1>오류고등학교 1학년 수강신청 시뮬레이터</h1>
<div id="studentInfo">
    <label>학번: <input type="text" id="studentId" style="margin-right:20px;"></label>
    <label>이름: <input type="text" id="studentName"></label>
    <label>희망학과(계열): <input type="text" id="studentMajor"></label>
  </div>

<div class="notice-box">
  <h3>📌 신청 시 유의사항</h3>
  <ul>
    <li>1. 국어, 수학, 영어 영역의 과목 신청 총합은 <strong>57학점</strong>을 초과할 수 없습니다.</li>
    <li>2. 제2외국어, 정보, 교양 영역의 과목 신청 총합은 <strong>12학점 이상</strong> 신청해야 합니다.</li>
  </ul>
</div>
<div class="legend">
  <div class="legend-item" style="background-color:#fff9c4;">국어</div>
  <div class="legend-item" style="background-color:#bbdefb;">수학</div>
  <div class="legend-item" style="background-color:#ffcdd2;">영어</div>
  <div class="legend-item" style="background-color:#ffe0b2;">사회</div>
  <div class="legend-item" style="background-color:#c8e6c9;">과학</div>
  <div class="legend-item" style="background-color:#CCD5FF;">체육</div>
  <div class="legend-item" style="background-color:#f8bbd0;">예술</div>
  <div class="legend-item" style="background-color:#b2dfdb;">정보</div>
  <div class="legend-item" style="background-color:#e1bee7;">제2외국어</div>
  <div class="legend-item" style="background-color:#e4dcd9;">교양</div>
</div>
  <div class="footer">made by 김민범&이현우선생님</div>

<div class="semester-container">
  <div class="semester" id="semester-2-1">
<h2>2학년 1학기</h2>
      <!-- 1행: 선택 가능 과목 리스트 -->
      <div class="course-area">
        <div class="area-title">필수 과목</div>
        <div class="course-list">
          <div class="course-item fixed course-korean">문학_일(4)</div>
          <div class="course-item fixed course-math">대수_일(4)</div>
          <div class="course-item fixed course-english">영어1_일(4)</div>
          <div class="course-item fixed course-physical">스포츠생활1_융(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목1 (3개 선택)</div>
        <div class="course-list">
          <div class="course-item course-korean">독서토론글쓰기_융(4)</div>
          <div class="course-item course-math">기하_진(4)</div>
          <div class="course-item course-english">미디어영어_융(4)</div>
          <div class="course-item course-society">사회와 문화_일(4)</div>
          <div class="course-item course-society">경제_진(4)</div>
          <div class="course-item course-society">세계시민과 지리_일(4)</div>
          <div class="course-item course-society">역사로 탐구하는 현대세계_융(4)</div>
          <div class="course-item course-science">생명과학_일(4)</div>
          <div class="course-item course-science">물리학_일(4)</div>
          <div class="course-item course-physical">운동과건강_진(4)</div>
          <div class="course-item course-language">중국어1_일(4)</div>
          <div class="course-item course-language">일본어1_일(4)</div>
          <div class="course-item course-language">스페인어1_일(4)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목2 (1개 선택)</div>
        <div class="course-list">
          <div class="course-item course-art">음악연주와 창작_진(2)</div>
          <div class="course-item course-art">미술 창작_진(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목3 (1개 선택)</div>
        <div class="course-list">
          <div class="course-item course-liberal">인간과 심리_진(2)</div>
          <div class="course-item course-liberal">보건_진(2)</div>
                  </div>
      </div>
      <!-- 2행: 내 선택과목 바구니 -->
      <div class="basket" id="basket-2-1">
        <div class="basket-title">내 선택과목</div>
        <!-- 선택된 과목이 여기에 표시될 예정 -->
      </div>
    </div>
  <div class="semester" id="semester-2-2">
      <h2>2학년 2학기</h2>
      <div class="course-area">
        <div class="area-title">필수 과목</div>
        <div class="course-list">
          <div class="course-item fixed course-korean">화법과 언어_일(4)</div>
          <div class="course-item fixed course-math">미적분1_일(4)</div>
          <div class="course-item fixed course-english">영어2_일(4)</div>
          <div class="course-item fixed course-physical">스포츠생활2_융(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택 과목 (4학점 4개 또는 4학점 3개 + 2학점 2개)</div>
        <div class="course-list">
          <div class="course-item course-korean">주제 탐구 독서_진(4)</div>
          <div class="course-item course-math">인공지능수학_진(4)</div>
          <div class="course-item course-math">경제 수학_진(4)</div>
          <div class="course-item course-english">세계문화와 영어_융(4)</div>
          <div class="course-item course-society">법과 사회_진(4)</div>
          <div class="course-item course-society">여행지리_융(4)</div>
          <div class="course-item course-society">동아시아역사기행_진(4)</div>
          <div class="course-item course-society">현대사회와 윤리_일(4)</div>
          <div class="course-item course-society">세계문제와 미래사회_융(4)</div>
          <div class="course-item course-science">화학_일(4)</div>
          <div class="course-item course-science">지구과학_일(4)</div>
          <div class="course-item course-science">전자기와 양자_진(4)</div>
          <div class="course-item course-science">생물의 유전_진(4)</div>
          <div class="course-item course-info">데이터 과학_정(4)</div>
          <div class="course-item course-language">중국어1_일(4)</div>
          <div class="course-item course-language">일본어1_일(4)</div>
          <div class="course-item course-language">스페인어1_일(4)</div>
          <div class="course-item course-liberal">인간과 심리_진(2)</div>
          <div class="course-item course-liberal">논리와 사고_진(2)</div>
          <div class="course-item course-liberal">보건_진(2)</div>
          <div class="course-item course-liberal">통계와 사회_융(2)</div>
        </div>
      </div>
      <div class="basket" id="basket-2-2">
        <div class="basket-title">내 선택과목</div>
      </div>
    </div>
  <div class="semester" id="semester-3-1">
      <h2>3학년 1학기</h2>
      <div class="course-area">
        <div class="area-title">필수 과목</div>
        <div class="course-list">
          <div class="course-item fixed course-korean">독서와 작문_일(4)</div>
          <div class="course-item fixed course-math">확률과 통계_일(4)</div>
          <div class="course-item fixed course-physical">스포츠과학_진(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목1 (4개 선택)</div>
        <div class="course-list">
          <div class="course-item course-korean">문학과 영상_진(4)</div>
          <div class="course-item course-math">미적분2_진(4)</div>
          <div class="course-item course-english">영어독해와 작문_진(4)</div>
          <div class="course-item course-society">사회문제탐구_융(4)</div>
          <div class="course-item course-society">한국지리탐구_진(4)</div>
          <div class="course-item course-society">윤리와 사상_진(4)</div>
          <div class="course-item course-society">정치_진(4)</div>
          <div class="course-item course-science">역학과 에너지_진(4)</div>
          <div class="course-item course-science">물질과 에너지_진(4)</div>
          <div class="course-item course-science">화학반응의 세계_진(4)</div>
          <div class="course-item course-science">세포와 물질대사_진(4)</div>
          <div class="course-item course-science">지구시스템과학_진(4)</div>
          <div class="course-item course-science">행성우주과학_진(4)</div>
          <div class="course-item course-physical">심화체육전공실기_진(4)</div>
          <div class="course-item course-info">인공지능 기초_정(4)</div>
          <div class="course-item course-language">심화 일본어_진(4)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목2 (1개 선택)</div>
        <div class="course-list">
          <div class="course-item course-liberal">교육의 이해_진(2)</div>
          <div class="course-item course-liberal">인간과 철학_진(2)</div>
          <div class="course-item course-liberal">인간과 경제활동_융(2)</div>
          <div class="course-item course-liberal">논술_융(2)</div>
        </div>
      </div>
      <div class="basket" id="basket-3-1">
        <div class="basket-title">내 선택과목</div>
      </div>
  </div>
  <div class="semester" id="semester-3-2">
      <h2>3학년 2학기</h2>
      <div class="course-area">
        <div class="area-title">필수 과목</div>
        <div class="course-list">
          <div class="course-item fixed course-physical">스포츠문화_융(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목1 (4학점 5개 또는 4학점 4개 + 2학점 2개)</div>
        <div class="course-list">
          <div class="course-item course-korean">언어생활탐구_융(4)</div>
          <div class="course-item course-math">수학과제탐구_융(4)</div>
          <div class="course-item course-english">심화영어_진(4)</div>
          <div class="course-item course-english">심화영어독해와 작문_진(4)</div>
          <div class="course-item course-society">국제관계의 이해_진(4)</div>
          <div class="course-item course-society">도시의 미래 탐구_진(4)</div>
          <div class="course-item course-society">금융과 경제 생활_융(4)</div>
          <div class="course-item course-science">기후변화와 환경생태_융(4)</div>
          <div class="course-item course-science">융합과학탐구_융(4)</div>
          <div class="course-item course-language">일본문화_융(4)</div>
          <div class="course-item course-liberal">교육의 이해_진(2)</div>
          <div class="course-item course-liberal">인간과 철학_진(2)</div>
          <div class="course-item course-liberal">인간과 경제활동_융(2)</div>
          <div class="course-item course-liberal">논술_융(2)</div>
        </div>
      </div>
      <div class="course-area">
        <div class="area-title">선택과목2 (1개 선택)</div>
        <div class="course-list">
          <div class="course-item course-art">음악감상과 비평_진(4)</div>
          <div class="course-item course-art">미술감상과 비평_진(4)</div>
        </div>
      </div>
            <div class="basket" id="basket-3-2">
        <div class="basket-title">내 선택과목</div>
      </div>
  </div>
</div>
<div id="summary-totals" class="total-summary-box">
  <h3>🧮 영역별 총합 계산기</h3>
  <p id="summary-core">국어/수학/영어 영역 총합: <strong>0</strong>점</p>
  <p id="summary-others">제2외국어/정보/교양 영역 총합: <strong>0</strong>점</p>
</div>
<script>
  const domainOrder = [
    'course-korean',
    'course-math',
    'course-english',
    'course-society',
    'course-science',
    'course-physical',
    'course-art',
    'course-info',
    'course-language',
    'course-liberal'
  ];

  function sortByDomain(courseItems) {
    return Array.from(courseItems).sort((a, b) => {
      const getClassIndex = el => domainOrder.findIndex(cls => el.classList.contains(cls));
      return getClassIndex(a) - getClassIndex(b);
    });
  }
</script>
<script>
// 🟩 수강신청 로직
const semesterConfigs = {
  'semester-2-1': 30,
  'semester-2-2': 30,
  'semester-3-1': 28,
  'semester-3-2': 26
};

const courseLimits = {
  '선택과목1': 3,
  '선택과목2': 1,
  'semester-2-1-선택과목3': 1,
  'semester-3-1-선택과목1': 4,
  };

function attachClickHandlers() {
  document.querySelectorAll('.course-item').forEach(item => {
    if (!item.classList.contains('fixed')) {
      item.onclick = () => handleCourseClick(item);
    }
  });
}

function handleCourseClick(item) {
  const courseText = item.textContent;
  const semesterEl = item.closest('.semester');
  const semesterId = semesterEl.id;
  const basket = semesterEl.querySelector('.basket');
  const credit = parseInt(courseText.match(/\((\d+)\)/)[1]);

  const alreadySelected = Array.from(basket.querySelectorAll('.course-item')).some(el => el.textContent === courseText);
  if (alreadySelected) {
    alert('해당 과목을 중복 신청하였습니다.');
    return;
  }

  const isGlobalDuplicate = Array.from(document.querySelectorAll('.basket .course-item'))
    .some(el => el.textContent === courseText);
  if (isGlobalDuplicate) {
    alert('다른 학기에서 이미 신청한 과목입니다. 중복 신청할 수 없습니다.');
    return;
  }


  const courseArea = item.closest('.course-area');
  const areaTitleText = courseArea?.querySelector('.area-title')?.textContent.trim();
  const areaTitle = areaTitleText?.split(' ')[0];
  const dynamicKey = `${semesterId}-${areaTitle}`;
  const staticKey = areaTitle;
  let limit = courseLimits[dynamicKey] || courseLimits[staticKey];

// 👉 3학년 2학기 선택과목1은 개수 제한 예외 처리
if (semesterId === 'semester-3-2' && areaTitle === '선택과목1') {
  limit = null;
}

if (limit) {
  const selectedCount = Array.from(basket.querySelectorAll('.course-item')).filter(el => {
    const elArea = el.getAttribute('data-area');
    return elArea === dynamicKey || elArea === staticKey;
  }).length;

  if (selectedCount >= limit) {
    alert(`${areaTitle}에서는 최대 ${limit}개 과목만 선택할 수 있습니다.`);
    return;
  }
}


  const creditUsed = Array.from(basket.querySelectorAll('.course-item'))
    .map(el => parseInt(el.textContent.match(/\((\d+)\)/)[1]))
    .reduce((acc, val) => acc + val, 0);

  const maxCredit = semesterConfigs[semesterId];
  if (creditUsed + credit > maxCredit) {
    alert('신청 가능한 학점을 초과하였습니다.');
    return;
  }

  if (semesterId === 'semester-2-2') {
    const currentCredits = Array.from(basket.querySelectorAll('.course-item'))
      .map(el => parseInt(el.textContent.match(/\((\d+)\)/)[1]));
    const newCredits = [...currentCredits, credit];
    const totalCredits = newCredits.reduce((a, b) => a + b, 0);
    const electiveCredits = totalCredits - 14;
    const num4 = newCredits.filter(c => c === 4).length;
    const num2 = newCredits.filter(c => c === 2).length;

    if (electiveCredits > 16 ||
        (num2 === 1 && num4 > 3) ||
        (num2 === 2 && num4 > 3) ||
        (num2 > 2) ||
        (num4 > 4) ||
        (electiveCredits === 20 && !(num4 === 5 && num2 === 0) && !(num4 === 4 && num2 === 2))) {
      alert('2학년 2학기는 4학점 4과목 또는 4학점 3과목 + 2학점 2과목만 가능합니다.');
      return;
    }
  }
if (semesterId === 'semester-3-2' && areaTitle === '선택과목1') {
  const basketItems = document.querySelectorAll('#basket-3-2 .course-item');
  const selectedItems1 = Array.from(basketItems).filter(
    el => el.getAttribute('data-area') === 'semester-3-2-선택과목1'
  );

  const credits1 = selectedItems1.map(el =>
    parseInt(el.textContent.match(/\((\d+)\)/)[1])
  );
  const total1 = credits1.reduce((a, b) => a + b, 0);
  const num4 = credits1.filter(c => c === 4).length;
  const num2 = credits1.filter(c => c === 2).length;

  // 총 학점 초과 시 차단
  if (total1 > 20) {
    alert('3학년 2학기 선택과목1은 최대 20학점까지 선택할 수 있습니다.');
    return;
  }

  // 조합이 조건에 안 맞을 경우 차단
  if (total1 === 20) {
    const valid =
      (num4 === 5 && num2 === 0) ||
      (num4 === 4 && num2 === 2);

    if (!valid) {
      alert('선택과목1은 4학점 5과목 또는 4학점 4과목 + 2학점 2과목만 가능합니다.');
      return;
    }
  }
}



  const cloned = item.cloneNode(true);
  cloned.setAttribute('data-area', dynamicKey);

  // ✅ 삭제 이벤트 추가
  cloned.onclick = () => {
    cloned.remove();
    checkCredit(semesterId);
    updateTotalAreaSummary();
    updateSaveButtonVisibility(); // ✅ 과목 삭제 시에도 버튼 다시 판단
  };

  basket.appendChild(cloned);

  checkCredit(semesterId);
  updateTotalAreaSummary();
  updateSaveButtonVisibility(); // ✅ 과목 추가 시에도 버튼 판단

console.log('➡ dynamicKey:', dynamicKey);
console.log('➡ cloned.getAttribute(data-area):', cloned.getAttribute('data-area'));

}

function checkCredit(semesterId) {
  const semesterEl = document.getElementById(semesterId);
  const basket = semesterEl.querySelector('.basket');
  const maxCredit = semesterConfigs[semesterId];

  const selectedCredits = Array.from(basket.querySelectorAll('.course-item'))
    .map(el => parseInt(el.textContent.match(/\((\d+)\)/)[1]));

  const fixedCredits = Array.from(semesterEl.querySelectorAll('.course-item.fixed'))
    .map(el => parseInt(el.textContent.match(/\((\d+)\)/)[1]));

  const total = [...selectedCredits, ...fixedCredits].reduce((acc, val) => acc + val, 0);

  const summaryId = `summary-${semesterId}`;
  let summary = document.getElementById(summaryId);
  if (!summary) {
    summary = document.createElement('div');
    summary.id = summaryId;
    summary.style.marginTop = '8px';
    summary.style.fontSize = '13px';
    summary.style.fontWeight = 'bold';
    basket.parentNode.appendChild(summary);
  }
  summary.textContent = `현재 학점 총합: ${total} / ${maxCredit}`;

  if (total === maxCredit) {
    basket.classList.add('highlight-valid');
  } else {
    basket.classList.remove('highlight-valid');
  }

  updateSaveButtonVisibility(); // ✅ 저장 버튼 조건 재검사
}

function updateSaveButtonVisibility() {
  const allValid = Object.keys(semesterConfigs).every(id => {
    const el = document.getElementById(id)?.querySelector('.basket');
    return el?.classList.contains('highlight-valid');
  });

  const saveBtn = document.getElementById('save-btn');
  if (allValid) {
    saveBtn.style.backgroundColor = '#4CAF50';
    saveBtn.style.color = 'white';
    saveBtn.style.cursor = 'pointer';
    saveBtn.dataset.active = 'true'; // ✅ 활성 상태 표시
  } else {
    saveBtn.style.backgroundColor = '#ccc';
    saveBtn.style.color = '#666';
    saveBtn.style.cursor = 'default';
    saveBtn.dataset.active = 'false';
  }
}


function updateTotalAreaSummary() {
  const allCourses = document.querySelectorAll('.basket .course-item, .course-item.fixed');
  let coreSum = 0;
  let othersSum = 0;

  allCourses.forEach(el => {
    const credit = parseInt(el.textContent.match(/\((\d+)\)/)?.[1] || '0');
    if (
      el.classList.contains('course-korean') ||
      el.classList.contains('course-math') ||
      el.classList.contains('course-english')
    ) {
      coreSum += credit;
    }
    if (
      el.classList.contains('course-language') ||
      el.classList.contains('course-info') ||
      el.classList.contains('course-liberal')
    ) {
      othersSum += credit;
    }
  });

  document.getElementById('summary-core').innerHTML = `국어/수학/영어 영역 총합: <strong>${coreSum}</strong>점`;
  document.getElementById('summary-others').innerHTML = `제2외국어/정보/교양 영역 총합: <strong>${othersSum}</strong>점`;

  // ✅ 조건 만족 시 연두색 유지, 그렇지 않으면 색 제거
  const summaryBox = document.getElementById('summary-totals');
  if (coreSum <= 57 && othersSum >= 12) {
    summaryBox.style.backgroundColor = '#e8f5e9'; // 연두 배경
    summaryBox.style.border = '2px solid #4CAF50'; // 녹색 테두리
    summaryBox.style.color = '#2e7d32'; // 녹색 글자
  } else {
    summaryBox.style.backgroundColor = 'transparent'; // 기본 배경
    summaryBox.style.border = 'none'; // 테두리 제거
    summaryBox.style.color = '#000'; // 일반 글자색
  }
}



window.onload = () => {
  attachClickHandlers();

  document.querySelectorAll('.semester').forEach(sem => {
    const sid = sem.id;
    checkCredit(sid);
  });

  updateTotalAreaSummary(); // <- 여기에 고정 과목도 포함되도록 수정
  updateSaveButtonVisibility();
};

</script>
<!-- 저장 버튼 추가 -->
<button id="save-btn" style="position:fixed; bottom:60px; right:20px; padding:10px 20px; font-weight:bold; background:#ccc; color:#666; border:none; border-radius:8px; cursor:default;">저장</button>



<script>
document.getElementById('save-btn').onclick = () => {
  const isActive = document.getElementById('save-btn').dataset.active === 'true';
  if (!isActive) {
    alert('조건이 충족되지 않았습니다.');
    return;
  }
  // 전체 저장 로직 내용이 여기에 있어야 해!

  const countedTexts = new Set();

  const totalCoreCredits = Array.from(document.querySelectorAll('.basket .course-item, .course-item.fixed')).reduce((acc, el) => {
    if (
      (el.classList.contains('course-korean') ||
      el.classList.contains('course-math') ||
      el.classList.contains('course-english'))
    ) {
      const text = el.textContent;
      if (!countedTexts.has(text)) {
        countedTexts.add(text);
        const credit = parseInt(text.match(/\((\d+)\)/)?.[1] || '0');
        return acc + credit;
      }
    }
    return acc;
  }, 0);

  if (totalCoreCredits > 57) {
  alert('국어, 수학, 영어 영역의 신청 총합은 57점을 초과할 수 없습니다.');

  // 파란 테두리 추가
  document.querySelectorAll('.course-korean, .course-math, .course-english').forEach(el => {
    el.style.outline = '2px solid blue';
    el.style.outlineOffset = '-2px';
  });

  return;
} else {
  // 파란 테두리 제거
  document.querySelectorAll('.course-korean, .course-math, .course-english').forEach(el => {
    el.style.outline = '';
    el.style.outlineOffset = '';
  });
}


  const etcCredits = Array.from(document.querySelectorAll('.basket .course-item')).reduce((acc, el) => {
    if (
      el.classList.contains('course-language') ||
      el.classList.contains('course-info') ||
      el.classList.contains('course-liberal')
    ) {
      const credit = parseInt(el.textContent.match(/\((\d+)\)/)?.[1] || '0');
      return acc + credit;
    }
    return acc;
  }, 0);

if (etcCredits < 12) {
  alert('제2외국어, 정보, 교양 영역의 신청 총합은 12점 이상이어야 합니다.');

  // 빨간 테두리 표시
  document.querySelectorAll('.course-language, .course-info, .course-liberal').forEach(el => {
    el.classList.add('red-outline');
  });

  return;
} else {
  // 조건 만족 시 테두리 제거
  document.querySelectorAll('.course-language, .course-info, .course-liberal').forEach(el => {
    el.classList.remove('red-outline');
  });
}


  const studentId = document.getElementById('studentId').value.trim();
  const studentName = document.getElementById('studentName').value.trim();
 const studentMajor = document.getElementById('studentMajor').value.trim();


  if (!studentId || !studentName) {
    alert('학번과 이름을 입력하세요');
    return;
  }

  const capture = document.createElement('div');
  capture.style.width = '1123px';
  capture.style.minHeight = '794px';
  capture.style.display = 'grid';
  capture.style.gridTemplateColumns = 'repeat(4, 1fr)';
  capture.style.gap = '12px';
  capture.style.padding = '20px 24px 16px 24px';
  capture.style.boxSizing = 'border-box';
  capture.style.background = 'white';
  capture.style.fontFamily = 'Arial';
  capture.style.border = '1px solid #ccc';
  capture.style.position = 'fixed';
  capture.style.top = '-9999px';
  capture.style.alignContent = 'start';
  capture.style.justifyItems = 'start';

  const titleSection = document.createElement('div');
  titleSection.style.gridColumn = '1 / -1';
  titleSection.style.paddingBottom = '6px';
  titleSection.style.marginBottom = '6px';
  titleSection.style.borderBottom = '1px solid #bbb';

  const header = document.createElement('h2');
  header.textContent = `오류고등학교 과목 선택 수강신청 결과`;
  header.style.fontSize = '18px';
  header.style.margin = '0 0 4px';

  const info = document.createElement('p');
  info.textContent = `학번: ${studentId} / 이름: ${studentName} / 희망학과(계열): ${studentMajor}`;
  info.style.margin = '0';
  info.style.fontSize = '13px';

  titleSection.appendChild(header);
  titleSection.appendChild(info);
  capture.appendChild(titleSection);

  Object.keys(semesterConfigs).forEach(id => {
    const sem = document.getElementById(id);
    const title = sem.querySelector('h2').textContent;
    const fixedCourses = Array.from(sem.querySelectorAll('.course-item.fixed'));
    const selectedCourses = Array.from(sem.querySelectorAll(`#${id} .basket .course-item`));

    const box = document.createElement('div');
    box.style.width = '100%';
    box.style.border = '1px solid #ddd';
    box.style.borderRadius = '10px';
    box.style.padding = '6px 8px';
    box.style.background = '#ffffff';
    box.style.boxShadow = '0 1px 3px rgba(0,0,0,0.05)';
    box.style.display = 'flex';
    box.style.flexDirection = 'column';
    box.style.gap = '2px';
    box.style.minHeight = '140px';
    box.style.boxSizing = 'border-box';

    const sub = document.createElement('h3');
    sub.textContent = title;
    sub.style.borderBottom = '1px solid #aaa';
    sub.style.paddingBottom = '4px';
    sub.style.marginBottom = '6px';
    sub.style.fontSize = '14px';
    sub.style.marginTop = '0';
    box.appendChild(sub);

    const createCourseEntry = (el) => {
      const p = document.createElement('p');
      const bgColor = window.getComputedStyle(el).backgroundColor;

      p.textContent = `- ${el.textContent}`;
      p.style.display = 'inline-block';
      p.style.margin = '1px';
      p.style.padding = '2px 5px';
      p.style.borderRadius = '4px';
      p.style.fontSize = '11px';
      p.style.whiteSpace = 'nowrap';
      p.style.backgroundColor = bgColor;

      return p;
    };

   // 📘 필수 과목 라벨
if (fixedCourses.length > 0) {
  const fixedLabel = document.createElement('p');
  fixedLabel.textContent = '📘 필수 과목';
  fixedLabel.style.fontWeight = 'bold';
  fixedLabel.style.margin = '4px 0 2px';
  fixedLabel.style.fontSize = '12px';
  box.appendChild(fixedLabel);
  fixedCourses.forEach(el => box.appendChild(createCourseEntry(el)));
}

// 📗 선택 과목 라벨
if (selectedCourses.length > 0) {
  const selectLabel = document.createElement('p');
  selectLabel.textContent = '📗 선택 과목';
  selectLabel.style.fontWeight = 'bold';
  selectLabel.style.margin = '6px 0 2px';
  selectLabel.style.fontSize = '12px';
  box.appendChild(selectLabel);
  sortByDomain(selectedCourses).forEach(el => box.appendChild(createCourseEntry(el)));
}


// ✅ 미선택 과목
const allSelectable = Array.from(sem.querySelectorAll('.course-area:not(:first-child) .course-item'))
  .filter(el => !el.classList.contains('fixed'));
const unselectedCourses = allSelectable.filter(el =>
  !selectedCourses.some(sel => sel.textContent === el.textContent)
);

if (unselectedCourses.length > 0) {
  const missedLabel = document.createElement('p');
  missedLabel.textContent = '📕 미선택 과목';
  missedLabel.style.fontWeight = 'bold';
  missedLabel.style.margin = '18px 0 2px';
  missedLabel.style.fontSize = '12px';
  box.appendChild(missedLabel);

  sortByDomain(unselectedCourses).forEach(el => box.appendChild(createCourseEntry(el)));
}


    capture.appendChild(box);
  });

// ✅ 결과화면 상단 오른쪽에 범례 추가
const legendBox = document.createElement('div');
legendBox.style.position = 'absolute';
legendBox.style.top = '20px';
legendBox.style.right = '20px';
legendBox.style.display = 'flex';
legendBox.style.flexWrap = 'wrap';
legendBox.style.gap = '6px';
legendBox.style.background = '#f9f9f9';
legendBox.style.padding = '8px 12px';
legendBox.style.border = '1px solid #ccc';
legendBox.style.borderRadius = '8px';
legendBox.style.fontSize = '11px';
legendBox.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';

// 범례 항목들 정의
const legendItems = [
  { name: '국어', color: '#fff9c4' },
  { name: '수학', color: '#bbdefb' },
  { name: '영어', color: '#ffcdd2' },
  { name: '사회', color: '#ffe0b2' },
  { name: '과학', color: '#c8e6c9' },
  { name: '체육', color: '#CCD5FF' },
  { name: '예술', color: '#f8bbd0' },
  { name: '정보', color: '#b2dfdb' },
  { name: '제2외국어', color: '#e1bee7' },
  { name: '교양', color: '#e4dcd9' }
];

legendItems.forEach(item => {
  const div = document.createElement('div');
  div.textContent = item.name;
  div.style.backgroundColor = item.color;
  div.style.padding = '3px 8px';
  div.style.borderRadius = '6px';
  div.style.whiteSpace = 'nowrap';
  legendBox.appendChild(div);
});

capture.appendChild(legendBox);


  document.body.appendChild(capture);

  setTimeout(() => {
    html2canvas(capture).then(canvas => {
      const image = canvas.toDataURL('image/png');

      const link = document.createElement('a');
      link.href = image;
      link.download = `수강신청결과_${studentId}_${studentName || 'unknown'}.png`;
      document.body.appendChild(link);

      link.click();
      alert('수강신청 결과가 이미지로 저장되었습니다!');

      document.body.removeChild(link);
      document.body.removeChild(capture);
    }).catch(err => {
      alert('이미지 저장 중 오류가 발생했습니다.');
      console.error(err);
      document.body.removeChild(capture);
    });
  }, 300);
};
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
